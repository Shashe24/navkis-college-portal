<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Login</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>body { font-family: 'Inter', sans-serif; }</style>
  <script>
    function handleLogin(event){
      event.preventDefault();
      try {
        const studentId = document.getElementById('student-id').value.trim();
        const password = document.getElementById('password').value;
        
        if (!studentId) {
          alert('Please enter your Student ID');
          return;
        }
        
        // Check if student exists in admin data
        const studentExists = checkStudentExists(studentId);
        if (!studentExists) {
          alert('Student ID not found in our records. Please contact administration.');
          return;
        }
        
        // Check if this is first time login (no password set)
        const storedPassword = localStorage.getItem(`student_password_${studentId}`);
        
        if (!storedPassword) {
          // First time login - create password
          if (!password) {
            alert('Please create a password for your account');
            return;
          }
          if (password.length < 6) {
            alert('Password must be at least 6 characters long');
            return;
          }
          
          // Store the new password
          localStorage.setItem(`student_password_${studentId}`, password);
          alert('Password created successfully! You can now login with your Student ID and password.');
          
          // Set login session
          localStorage.setItem('role', 'student');
          localStorage.setItem('studentId', studentId);
          window.location.href = 'student-view.html';
          
        } else {
          // Regular login - verify password
          if (!password) {
            alert('Please enter your password');
            return;
          }
          
          if (password !== storedPassword) {
            alert('Incorrect password. Please try again.');
            return;
          }
          
          // Successful login
          localStorage.setItem('role', 'student');
          localStorage.setItem('studentId', studentId);
          window.location.href = 'student-view.html';
        }
        
      } catch (e) {
        console.error('Login error:', e);
        alert('Login failed. Please try again.');
      }
    }
    
    function checkStudentExists(studentId) {
      // Search through all admin data to find the student
      for (let key of Object.keys(localStorage)) {
        if (key.startsWith('admin_student_data_')) {
          try {
            const data = JSON.parse(localStorage.getItem(key));
            if (data && data.students) {
              const student = data.students.find(s => s.student_id === studentId);
              if (student) {
                return true;
              }
            }
          } catch (e) {
            console.error('Error parsing data:', e);
          }
        }
      }
      return false;
    }
    
    function updatePasswordField() {
      const studentId = document.getElementById('student-id').value.trim();
      const passwordField = document.getElementById('password');
      const passwordLabel = document.getElementById('password-label');
      const passwordHelp = document.getElementById('password-help');
      
      if (studentId) {
        const storedPassword = localStorage.getItem(`student_password_${studentId}`);
        if (!storedPassword) {
          // First time login
          passwordLabel.textContent = 'Create Password';
          passwordHelp.textContent = 'Create a password for your account (minimum 6 characters)';
          passwordField.placeholder = 'Create your password';
        } else {
          // Regular login
          passwordLabel.textContent = 'Password';
          passwordHelp.textContent = 'Enter your password';
          passwordField.placeholder = 'Enter your password';
        }
      }
    }
  </script>
</head>
<body class="min-h-screen" style="background-image: url('unnamed (1).webp'); background-size: cover; background-position: center; background-repeat: no-repeat;">
  <div class="max-w-md mx-auto px-6 py-16 relative z-10">
    <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl border border-slate-100 p-8">
      <h1 class="text-2xl font-extrabold text-slate-900">Student Login</h1>
      <p class="text-slate-600 mt-1">Sign in to access your dashboard</p>
      <form class="mt-6 space-y-4" onsubmit="handleLogin(event)">
        <div>
          <label class="block text-sm font-medium text-slate-700">Student ID / USN</label>
          <input type="text" id="student-id" required 
                 oninput="updatePasswordField()" 
                 class="mt-1 w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
                 placeholder="Enter your Student ID or USN">
        </div>
        <div>
          <label id="password-label" class="block text-sm font-medium text-slate-700">Password</label>
          <input type="password" id="password" required 
                 class="mt-1 w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
                 placeholder="Enter your password">
          <p id="password-help" class="mt-1 text-xs text-slate-500">Enter your password</p>
        </div>
        <button type="submit" class="w-full bg-blue-600 text-white font-semibold rounded-lg py-2.5 hover:bg-blue-700">Login</button>
      </form>
      <div class="mt-4 text-sm text-center">
        <a class="text-blue-600 hover:underline" href="index.html">Back to roles</a>
      </div>
    </div>
  </div>
</body>
</html>


